#include "ITriangleRasterizer.h"

#include "swgl.h"
#include "RasterAlgorithms.h"


struct TriangleRasterizer_ScanLinePreciseNoSSE : public ITriangleRasterizer
{
  TriangleRasterizer_ScanLinePreciseNoSSE();

  uint64_t SupportedModesFlags()   const override;
  void     DrawBatch(SWGL_Context* a_pContext, Batch* pBatch) override;

protected:

};

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

TriangleRasterizer_ScanLinePreciseNoSSE::TriangleRasterizer_ScanLinePreciseNoSSE()
{

}

uint64_t TriangleRasterizer_ScanLinePreciseNoSSE::SupportedModesFlags() const
{
  return RM_FillColor         | \
         RM_Colored2D         | \
         RM_Colored3D         | \
         RM_TexLinear2D       | \
         RM_TexLinear3D       | \
         RM_TexLinear2D_Blend | \
         RM_TexLinear3D_Blend | \
         RM_StencilFill2D     | \
         RM_StencilFill3D;
}

void swglDrawBatchTriangles(SWGL_Context* a_pContext, Batch* pBatch, FrameBuffer& frameBuff);

void TriangleRasterizer_ScanLinePreciseNoSSE::DrawBatch(SWGL_Context* a_pContext, Batch* pBatch)
{
  swglRunBatchVertexShaderNoSSE(a_pContext, pBatch);

  FrameBuffer frameBuff = swglBatchFb(a_pContext, pBatch->state);
  
  swglDrawBatchTriangles(a_pContext, pBatch, frameBuff);
  
  swglDrawBatchLines(a_pContext, pBatch, frameBuff);
  
  swglDrawBatchPoints(a_pContext, pBatch, frameBuff);
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

ITriangleRasterizer* CreateRasterizer(char* a_name)
{
  return new TriangleRasterizer_ScanLinePreciseNoSSE;
}